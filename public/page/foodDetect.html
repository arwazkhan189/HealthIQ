<!DOCTYPE html>
<html>

<head>
  <title>Food Detect | HealthIQ</title>
</head>

<body>
  <h1>Food Detect | HealthIQ</h1>
  <p>
    Temperature: <span id="temperature"></span> Â°C | Humidity: <span id="humidity"></span> % | Gas: <span
      id="gas"></span> ppm
  </p>

  <p id="detectSpoil"></p>
  <p id="alert"></p>
  <p id="errorDevice"></p>
  <script>
    // client.js
    const updateInterval = 1000; // Update interval in milliseconds

    // Function to update the sensor data on the page
    function updateSensorData() {
      fetch('/iotdata')
        .then(response => response.json())
        .then(data => {
          const temperatureElement = document.getElementById('temperature');
          const humidityElement = document.getElementById('humidity');
          const gasElement = document.getElementById('gas');
          const detectSpoilElement = document.getElementById('detectSpoil');
          const alertElement = document.getElementById('alert');
          const errorElement = document.getElementById('errorDevice');

          temperatureElement.innerText = data.temperature;
          humidityElement.innerText = data.humidity;
          gasElement.innerText = data.gas;

          if (data.temperature == undefined) {
            errorElement.innerText = 'Error fetching data from device!';
          } else {
            errorElement.innerText = '';
          }
          if (data.temperature > 33 || data.humidity > 63 || data.gas > 33) {
            detectSpoilElement.innerText = "Food is spoiled!";
            alertElement.innerText = "Alert!, Email and Sms sent to the user!";
          } else {
            detectSpoilElement.innerText = "Food is not spoiled!";
            alertElement.innerText = "";
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          const errorElement = document.getElementById('errorDevice');
          errorElement.innerText = 'Error fetching data from device!';
        });
    }

    // Update the sensor data periodically
    setInterval(updateSensorData, updateInterval);
  </script>
</body>

</html>