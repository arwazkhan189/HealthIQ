<!DOCTYPE html>
<html>

<head>
    <title>Profile | HealthIQ</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 0 auto;
            font-size: 16px;
        }

        th,
        td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #333;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        li {
            margin-bottom: 5px;
        }

        a {
            text-decoration: none;
            color: blue;
            margin-left: 5px;
        }

        .btn-group {
            display: flex;
            justify-content: center;
        }

        .btn-group a:hover {
            background-color: #394C31;
        }

        .btn-group .signoutBtn {
            background-color: red;
            border: 1px solid #43762d;
            color: white;
            padding: 0.5em;
            cursor: pointer;
            margin: 1%;
            border-radius: 20px;
        }

        .change {
            padding: 10px 15px;
            background-color: orange;
            border-radius: 20px;
            color: white;
            text-decoration: none;
        }

        .print {
            padding: 10px 15px;
            background-color: rgb(192, 167, 121);
            border-radius: 20px;
            color: white;
            text-decoration: none;
        }

        .delete {
            padding: 10px 15px;
            background-color: red;
            border-radius: 20px;
            color: white;
            text-decoration: none;
        }
    </style>
    <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
</head>

<body>
    <div class="btn-group">
        <a href="#" onclick="signOut()" class="signoutBtn">Sign Out</a>
    </div>

    <h1>Weekly Diet Plan</h1>
    <div class="btn-group">
        <a href="#" onclick="printDietPlan()" class="print">Print Diet Plan</a>
        <a href="/diet" class="change">Change Diet Plan</a>
        <a href="#" onclick="deleteDietPlan()" id="deleteBtn" class="delete">Delete Diet Plan</a>
    </div>
    <table id="dietPlanTable">
        <thead>
            <tr>
                <th>Day</th>
                <th>Meals</th>
                <th>Calories</th>
                <th>Protein</th>
                <th>Fat</th>
                <th>Carbohydrates</th>
            </tr>
        </thead>
        <tbody>
            {{#each dietData.week}}
            <tr>
                <td>{{@key}}</td>
                <td>
                    <ul>
                        {{#each this.meals}}
                        <li>
                            {{this.title}}
                            ({{this.readyInMinutes}} minutes/Servings: {{this.servings}})
                            <a href={{this.sourceUrl}} target=" _blank">Get the Recipe</a>
                        </li>
                        {{/each}}
                    </ul>
                </td>
                <td>{{this.nutrients.calories}}</td>
                <td>{{this.nutrients.protein}}</td>
                <td>{{this.nutrients.fat}}</td>
                <td>{{this.nutrients.carbohydrates}}</td>
            </tr>
            {{/each}}
        </tbody>
    </table>

    <h1>Workout Plan</h1>
    <div class="btn-group">
        <a href="#" onclick="printWorkoutPlan()" class="print">Print Workout Plan</a>
        <a href="/workout" class="change">Change Workout Plan</a>
        <a href="#" onclick="deleteWorkoutPlan()" id="deleteBtn" class="delete">Delete Workout Plan</a>
    </div>
    <table id="workoutPlanTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Force</th>
                <th>Workout Type</th>
                <th>Primary Muscles</th>
                <th>Secondary Muscles</th>
                <th>Youtube Link</th>
            </tr>
        </thead>
        <tbody>
            {{#each workoutData.data}}
            <tr>
                <td>{{this.Name}}</td>
                <td>{{this.Type}}</td>
                <td>{{this.Force}}</td>
                <td>
                    <ul>
                        {{#each this.[Workout Type]}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </td>
                <td>
                    <ul>
                        {{#each this.[Primary Muscles]}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </td>
                <td>
                    <ul>
                        {{#each this.[SecondaryMuscles]}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </td>
                <td><a href={{this.[Youtube link]}} target="_blank">Check out the video</a></td>
            </tr>
            {{/each}}
        </tbody>
    </table>

</body>
<script>

    function signOut() {
        Swal.fire({
            title: 'Do you want to signout?',
            showCancelButton: true,
            confirmButtonText: 'Yes',
        }).then(async (result) => {
            if (result.isConfirmed) {
                try {
                    const res = await fetch("/signout", {
                        method: "GET"
                    });
                    if (res.status == 200) {
                        location.assign("/signin");
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: res.status,
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: error,
                    });
                }
            }
        })
    }

    function deleteDietPlan() {
        Swal.fire({
            title: 'Are you sure?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then(async (result) => {
            if (result.isConfirmed) {
                try {
                    const res = await fetch(`/deleteDietPlan`, {
                        method: "POST",
                        headers: { 'Content-Type': 'application/json' }
                    });
                    const data = await res.json();
                    if (data) {
                        Swal.fire(
                            'Deleted!',
                            'Your Weekly Diet Plan has been deleted.',
                            'success'
                        ).then(() => {
                            location.reload();
                        });
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: res.status,
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: error,
                    });
                }
            }
        });
    }

    function deleteWorkoutPlan() {
        Swal.fire({
            title: 'Are you sure?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then(async (result) => {
            if (result.isConfirmed) {
                try {
                    const res = await fetch(`/deleteWorkoutPlan`, {
                        method: "POST",
                        headers: { 'Content-Type': 'application/json' }
                    });
                    const data = await res.json();
                    if (data) {
                        Swal.fire(
                            'Deleted!',
                            'Your Workout Plan has been deleted.',
                            'success'
                        ).then(() => {
                            location.reload();
                        });
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: res.status,
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: error,
                    });
                }
            }
        });
    }

    function printDietPlan() {
        var dietPlanTable = document.getElementById("dietPlanTable");
        var opt = {
            margin: 1,
            top:0,
            filename: 'HealthIQ_Diet_plan.pdf',
            enableLinks:true
        };
        var worker = html2pdf();
        worker.set(opt).from(dietPlanTable).save();
    }

    function printWorkoutPlan() {
        var workoutPlanTable = document.getElementById("workoutPlanTable");
        var opt = {
            filename: 'HealthIQ_Workout_plan.pdf',
            enableLinks:true
        };
        var worker = html2pdf()
        worker.set(opt).from(workoutPlanTable).save();
    }


</script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</html>